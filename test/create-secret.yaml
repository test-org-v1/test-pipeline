parameters:
- name: experimentalTemplate
  displayName: 'Use DR templates ?'
  type: boolean
  default: false

variables:
- ${{ if eq(parameters.experimentalTemplate, false) }}:
  - template: ./test2.yaml
- ${{ else }}:
  - template: ./test3.yaml

pool:
  - name: 'asgardeo-stage-scale-set-agents'
  - ${{ if eq(parameters.experimentalTemplate, true) }}:
    demands:
    - Agent.Name -equals 'asgardeo-stagedr-scale-set-agents'
 

jobs:
  - job: install_kubectl
    displayName: Install Kubectl
    steps:
    - task: KubectlInstaller@0
      displayName: Install Kubectl
      inputs:
        kubectlVersion: '1.18.13'

  - job: create_secret
    displayName: Create K8s secret
    steps:
    - task: KubernetesManifest@0
      displayName: Create secret
      inputs: 
        action: createSecret
        secretType: generic
        secretName: some-secret
        secretArguments: --from-literal=key1=value1
        kubernetesServiceConnection: asg-test-aks-connection
        namespace: default

  - job: test_vars
    displayName: Check Vars
    steps:
    - bash: echo ${{variables.VAR}}